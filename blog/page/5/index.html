
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Builder's notes</title>
	<meta name="author" content="Erick Pérez Castellanos">

	
	<meta name="description" content="Hi everyone. It&#8217;s been a while since I blogged something. Been busy day-to-day work. Yesterday something started to bug me, a new project like &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Builder's notes" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">Builder's notes</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:erick2red.github.com">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		<a class="google" href="https://plus.google.com/111653970154711735047?rel=author" title="Google+">Google+</a>
		
		
		<a class="twitter" href="http://twitter.com/erick2red" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/erick2red" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:erick2red.github.com">
	</form>
</nav>

</header>
	
		
<div id="banner" class="inner">
	<div class="container">
		<ul class="feed"></ul>
	</div>
	<small><a href="http://twitter.com/erick2red">erick2red</a> @ <a href="http://twitter.com">Twitter</a></small>
	<div class="loading">Loading...</div>
</div>
<script src="/javascripts/twitter.js"></script>
<script type="text/javascript">
	(function($){
		$('#banner').getTwitterFeed('erick2red', 4, false);
	})(jQuery);
</script>

	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2011/06/28/developing-for-gtkglib/">
		
			Developing for Gtk/Glib</a>
	</h2>
	<div class="entry-content">
		<p>Hi everyone. It&#8217;s been a while since I blogged something. Been busy day-to-day work.</p>

<p>Yesterday something started to bug me, a new project like, a new toy application. After some modeling/sketching on a page I decided to start writing some demo code.</p>

<p>It took me a while to notice that I&#8217;m far from setting a GObject development environment fast. I&#8217;m using <a href="http://www.eclipse.org/downloads/packages/eclipse-ide-cc-linux-developers-includes-incubating-components/indigor">Eclipse IDE for C/C++ Linux Developers</a>, and valgrind and the usual tools in my Archlinux. There&#8217;s, by the way, a package group in pacman called base-devel, I always had installed first hand.</p>

<p>Anyway I&#8217;ll talk about the main three issues I found in my way to set up start and star coding some mockups and early designs of my toy app.</p>

<p><strong>Autotools packaging</strong></p>

<p>I&#8217;m not the guy who lined up with cmake cause autotools is old, and should be improved, although I think it needs some improvements [1]. The main issue with autotools is that it is hard to learn, the existent documentation is little and somewhat cryptic, and that makes the learning curve steep. After read some things on the web, and been this not first time I stand before the issues, I did what I think everyone should, I made my own sample-autootols project which keeps a minimal configuration of what I need to develop a Gtk application. I included tips from <a href="http://blogs.gnome.org/jjardon/2010/01/25/modernize-your-autotools-build-system/">this post</a> about improving and modernizing the autotools configuration, and some others about using <a href="http://mail.gnome.org/archives/desktop-devel-list/2011-May/msg00599.html">xz compression instead of gz</a>. The project is in <a href="https://github.com/erick2red/autotools-sample">github</a>, and I&#8217;m planning to improve it with several configurations for several kinds of builds. Anyway, that for point one, I will keep my template at hand, but I think for new developers, and for the good of the platform, Gnome should make something like Ubuntu Quickly. Note: I&#8217;ve tried to use anjuta, really tried, but it doesn&#8217;t feel right or stable, and this is not for the developers to take it personal, it just my experience with it had been bad.</p>

<p><strong>GObject based C class</strong></p>

<p>This is so simple is really a shame it had taken me so long to pass this point. I needed some GObject based class, to handle some  internals structures of my application, and then I found myself copying parts of devhelp tutorials to headers and sources files to build the class, this code is all templates, is the same over and over for every class I had and have to make. I just want some script that make me the files after I provide the name of the class I want. If I had the time to learn howto make Eclipse plugins I&#8217;ll make the Eclipse Template for those files header and source file for  a GObject based class. I tried vala before and I know it does, one possible solution is for vala to print the translation into some pretty formatted code. If I can&#8217;t find any solution soon, I&#8217;ll make some awk script that output the files with the required boilerplate needed.</p>

<p><strong>Valgrind debugging</strong></p>

<p>Finally, the third point is the fair beginner one, I have to say this pretty much my first time doing C development of Gtk/Glib applications. Until now I&#8217;ve used some vala, and some JavaScript, and some C++, but C, nope, so I think this is mainly why I found this obstacles in my path. After having some windows running and some buttons doings it&#8217;s work I felt it was time to profile the memory usage I was using. I used valgrind since the Eclipse bring with support for it included, and I notice I need a suppression file for Gtk/Glib <em>possible memory lost</em>, which isn&#8217;t real. Digged a little on the web, actually digged nothing this was the first results that pops out: <a href="https://live.gnome.org/Valgrind">Valgrind at live.gnome.org</a>, and I went after the suppression file, just to learn that the file was missing or something else (I&#8217;m getting some internal error, which I now realize I have to tell the maintainers of the wiki). After that I decided I have to do it by myself. I think that the gnome developers should have a file like that somewhere, but I&#8217;m to shy to ask for it, so I&#8217;ll take the time to do one for me, someday.</p>

<p>Again I think that, in order to promote the platform, is necessary to publish things like this, The new look of <a href="http://developer.gnome.org/">developer.gnome.org</a> and the samples in there helps to that purpose, but still feel more work in that direction is missing.</p>

<p>[1] Autotools needs to handle parallel configure, since parallel <em>make</em> is handled by the <em>-j</em> flag.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-06-28T13:13:41-04:00" pubdate data-updated="true">Jun 28<span>th</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/development/'>Development</a>


</div>
	
	<div class="comments"><a href="/blog/2011/06/28/developing-for-gtkglib/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2011/06/05/dbus-in-the-shell/">
		
			DBus in the Shell</a>
	</h2>
	<div class="entry-content">
		<p>As a companion of the post <a href="http://erick2red.wordpress.com/2011/05/28/dbus-in-gjs-and-gnome-shell/">I made before</a> on connecting to DBus exported objects on Gjs JavaScript runtime over the Shell, should be other post talking as how to export object over DBus inside Shell JavaScript environment. More or less this one is about that.</p>

<p>The code I will show here isn&#8217;t mine, even I think I contribute some part to it, the main architecture of the thing was already made by the time the code get to me. That part of thanks for the help, and the guidance should go to Vamsi Krishna Brahmajosyula.</p>

<p>So, let’s get our hands dirty</p>

<p>First you need to create the interface you will export, similar to the way you made before for getting proxy objects.</p>

<p>[sourcecode language=&#8221;javascript&#8221;]
const LoggerIface = {</p>

<pre><code>name: 'org.gnome.Logger',
methods: [{
            name: 'log',
            inSignature: 's',
            outSignature: ''
          }
       ],
signals: [{
            name: 'added',
            inSignature: 's'
        }],
properties: []
</code></pre>

<p>};
[/sourcecode]</p>

<p>As you can see, we&#8217;ll planning to create an object exporting one method &#8216;Logger::log&#8217; and one signal &#8216;Logger::added&#8217;. The method has one parameter and no return value, and the signal has one arguments, in both cases the argument/parameters is the same, the message log sent. So, our objects will have and array of log messages sent to him, and for every time you call its method &#8216;log&#8217; it emit the signal added. Very simple.</p>

<p>Now we&#8217;ll create the object conforming the interface we defined before.</p>

<p>[sourcecode language=&#8221;javascript&#8221;]
function Logger() {</p>

<pre><code>this._init();
</code></pre>

<p>}</p>

<p>Logger.prototype = {</p>

<pre><code>_init: function() {
    this.logs = [];
    DBus.session.exportObject('/org/gnome/Logger', this);
},

log: function(message) {
    this.logs.push(message);
    global.log('Received: ' + message);
    this._emitAdded(message);
},

_emitAdded: function(message) {
    DBus.session.emit_signal('/org/gnome/Logger',
                             'org.gnome.Logger',
                             'Added', 's',
                             [message]);
}
</code></pre>

<p>};
[/sourcecode]</p>

<p>As you see we defined a method with the same name we did in the interface and the same signature. And now we&#8217;ll pass to see the Gjs DBus magic:</p>

<p>[sourcecode language=&#8221;javascript&#8221;]
DBus.session.exportObject(&#8216;/org/gnome/Logger&#8217;, this);
[/sourcecode]</p>

<p>This was called inside our _init method, and that’s the method of the Gjs telling DBus, this is the object we want to export. And, later on this one is the one telling DBus to check if our class/prototype conforms the interface we said it conforms:</p>

<p>[sourcecode language=&#8221;javascript&#8221;]
DBus.conformExport(Logger.prototype, LoggerIface);
[/sourcecode]</p>

<p>Finally the extension entry point. Ohh wait I didn’t said that before, we’re reviewing an extension, as this is a so easy way to test Gnome 3 stuff. So the entry point, the main function.</p>

<p>[sourcecode language=&#8221;javascript&#8221;]
function main() {</p>

<pre><code>// I did this to get the object after the extension code run
Main.logger = new Logger()

//this was the missing instruction
DBus.session.acquire_name('org.gnome.Logger', 0, null, null);
</code></pre>

<p>}
[/sourcecode]</p>

<p>And here is a great trick, you see that line saying &#8220;this was the missing instruction&#8221;, yeah I had all the code written and reviewed like a thousand times, and still doesn&#8217;t worked, I keep testing but nothing the object wasn&#8217;t there. I opened Looking Glass, and typed Main.logger and the object was create, but it wasn&#8217;t receiving any notice when I called the method, actually I was getting errors cause that method doesn&#8217;t existed at all. After some back and forward between DBus documentation, and Gnome Shell source code, I figured out. The missing part was, of course, I’ve should known, the part when your object grab the DBus name it want to publish. So first I went to <strong>DBus.session.own_name</strong> but that is not a function, and then I tried this one <strong>DBus.session.acquire_name</strong>, with doesn&#8217;t exist at all in the devhelp documentation but it seems is the wrapper of Gjs for the <strong>own_name</strong> GDBus method.</p>

<p>So, that’s all for now. I know I’m still missing some things. I want to learn how catch a signal emit over DBus, and how to handle exported object properties, make some samples and toy with it a bit.</p>

<p>But that will be later. Keep in touch.</p>

<p>BTW: I&#8217;m still figuring out how to publish the full examples, but I will do it, sometime</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-06-05T01:09:27-04:00" pubdate data-updated="true">Jun 5<span>th</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/coding-samples/'>Coding Samples</a>


</div>
	
	<div class="comments"><a href="/blog/2011/06/05/dbus-in-the-shell/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2011/05/31/json-parse-and-json-stringify/">
		
			JSON.parse and JSON.stringify</a>
	</h2>
	<div class="entry-content">
		<p>The Gnome Shell Extensions system is one mighty and powerful beast. Just yesterday I found myself wanting to have a simple list of stuff I wanted to check later. After looking around a bit to storage components in Gnome Shell environment I decide I&#8217;ll use simple files with <a href="http://en.wikipedia.org/wiki/Json">JSON</a> strings inside.</p>

<p>I started coding and in a while I got my <a href="http://erick2red.wordpress.com/my-projects/shell-extensions/#wish-list">wish-list</a> extension. The  beauty of this is what I learnt in the process. Two stuff I never tried, before:</p>

<ul>
<li><p>Hacking with autotools: This is the kind of things you should know once you decide to get involved in software development for Linux.</p></li>
<li><p>How to hack a new kind of PopMenuItem for the Shell UI</p></li>
</ul>


<p>Since I have access to the facilities of JavaScript and GLib system from the extension I can do almost everything with it.
I used a file as a back-end for my list of wishes and  use JSON.parse for reading and parsing the content back into an array and JSON.stringify to dumps the objects into the file. You can go down through the code later. Anyway there&#8217;s those two snippets</p>

<p>Using GLib/Gio and JSON
[sourcecode language=&#8221;javascript&#8221;]
let dir = Gio.file_new_for_path(Main.ExtensionSystem.extensionMeta[UUID].path);
let listFile = dir.get_child(&#8216;lists.json&#8217;);</p>

<p>let raw = listFile.replace(null, false,</p>

<pre><code>                Gio.FileCreateFlags.NONE,
                null);
</code></pre>

<p>let out = Gio.BufferedOutputStream.new_sized (raw, 4096);
Shell.write_string_to_stream (out, JSON.stringify(this.list));
out.close(null)
[/sourcecode]</p>

<p>Instantiating PopupMenuItem
[sourcecode language=&#8221;javascript&#8221;]
PopupEntryMenuItem.prototype = {</p>

<pre><code>__proto__: PopupMenu.PopupBaseMenuItem.prototype,

_init: function (style) {
    PopupMenu.PopupBaseMenuItem.prototype._init.call(this, { activate: false });

    this.entry = new St.Entry({ style_class: style });

    this.entry.clutter_text.connect('key-press-event', Lang.bind(this, this._onKeyPress));
    this.addActor(this.entry, { span: -1, expand: true });

    this.actor.add_style_class_name('menu-entry');
}
</code></pre>

<p>}
Signals.addSignalMethods(PopupEntryMenuItem.prototype)
[/sourcecode]
The page is linked above. See you around.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-05-31T12:51:56-04:00" pubdate data-updated="true">May 31<span>st</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/news/'>News</a>


</div>
	
	<div class="comments"><a href="/blog/2011/05/31/json-parse-and-json-stringify/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2011/05/30/morning-echoes/">
		
			Morning Echoes</a>
	</h2>
	<div class="entry-content">
		<p>Here goes some of the morning news you can find around:</p>

<ul>
<li><p><a href="http://goo.gl/eS8It">Gnome-Shell vs Unity vs Others</a></p></li>
<li><p>The <a href="http://open-build-service.org/">OBS</a> will need a look, since it&#8217;s kinda a useful service for you providing packages for others distros.</p></li>
<li><p>Great <a href="http://goo.gl/tUqPs">Linux version bump</a> is coming ?</p></li>
<li><p><a href="http://goo.gl/rfIV5">Firefox 5</a> on the way</p></li>
</ul>


<p>Some tech now:</p>

<ul>
<li><p>Intel building chips for <a href="http://goo.gl/eV3hM">Apple ?</a></p></li>
<li><p><a href="http://goo.gl/IAEXj">AMD going for tablets</a>. Still a rumor</p></li>
</ul>


<p>And some jokes wouldn&#8217;t kill anyone:</p>

<ul>
<li><a href="http://xkcd.com/905/">Homeownership</a></li>
</ul>


<p>So, monday is kinda slow day, or at least at this time in the morning.</p>

<p>I&#8217;ll bring you back tomorrow or the day after that.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-05-30T08:34:52-04:00" pubdate data-updated="true">May 30<span>th</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/news/'>News</a>


</div>
	
	<div class="comments"><a href="/blog/2011/05/30/morning-echoes/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2011/05/28/dbus-in-gjs-and-gnome-shell/">
		
			DBus in Gjs and Gnome Shell</a>
	</h2>
	<div class="entry-content">
		<h6>The Story</h6>

<p>Last few days I’ve got a bunch of ideas about Gnome Shell extensions. Gnome 3 platform has made the development of Gnome really close to the public, more than anything by using JavaScript to made the Shell.</p>

<p>The use of JavaScript has lower the barrier for making contributions for Gnome Desktop, because JavaScript it&#8217;s a well known language in the web development world an it’s a easier language to learn than the typical C/C++ and even Python. There’s still some things to address about the use of JavaScript, the definition and standardization of an engine for use in the gnome development (look at this discussion about the use of <a href="http://live.gnome.org/Seed">Seed</a> or <a href="http://live.gnome.org/Gjs">Gjs</a> [1]), the stabilization of some interfaces in the actual engines, but there’s a lot of way made already.</p>

<p>About standardization and stabilization of interfaces goes this post. <a href="http://dbus.freedesktop.org">DBus</a> is a clever way of communication between process that has become almost a must have for every desktop application for providing services and hooks to internals API, the JavaScript engine powering Gnome Shell then, needs a DBus interface and here comes the problem.</p>

<p>When I realize of my need of using DBus when writing some Gnome-Shell extension I go through the process of selecting which DBus interface I will use. First I decide to use GLib <a href="http://developer.gnome.org/gio/2.26/gdbus.html">GDBus</a> interface since it goes inside GLib, so no matters which JavaScript engine you use, as long as it has GLib bindings it should work. I avoid the low-level interfaces, and I got the Devhelp documentation to work with so, It just left start coding.</p>

<p>After a while I realize that not everything worked as I thought, first and the biggest problem I had was the need of using GLib.Variant in JavaScript to define the signature of the methods you call over DBus and the fact the Gjs not implement GLib.Variant support or at least as long as I can find. I tried with almost every method declared in the GLib-2.0.gir file which is suppose to provide the introspection data, no one works. After asking in the JavaScript mailing list, and got no answer, I decide I should give up and use DBus interface provided by Gjs.</p>

<h6>The Code</h6>

<p>After looking around, I decide to go the only way, reading Gnome Shell code.</p>

<p>For calling a method exported over DBus using Gjs the first is import (include, load the code) the unit containing the DBus interface</p>

<pre><code>&lt;span class="kwrd"&gt;const&lt;/span&gt; DBus = imports.dbus;
</code></pre>

<p>This code loads the JavaScript file dbus.js. After that you need to declare the interface you’re trying to reach and the signature of the methods you’re planning to call</p>

<pre><code>&lt;span class="kwrd"&gt;const&lt;/span&gt; NotificationRemoteInterface = {
    name: &lt;span class="str"&gt;'org.freedesktop.Notifications'&lt;/span&gt;, &lt;span class="rem"&gt;//interface name&lt;/span&gt;
    methods: [
        {    &lt;span class="rem"&gt;//method name and signature&lt;/span&gt;
            name: &lt;span class="str"&gt;'Notify'&lt;/span&gt;,
            inSignature: &lt;span class="str"&gt;'susssasa{sv}i'&lt;/span&gt;,
            outSignature: &lt;span class="str"&gt;'u'&lt;/span&gt;
        }
    ]
};
</code></pre>

<p>Now it comes the Gjs-DBus implementation magic, you need to call this method from DBus object tha makes a class of the proxy object you’ll need to instantiate</p>

<pre><code>let NotificationProxy = DBus.makeProxyClass(NotificationRemoteInterface);
</code></pre>

<p>After that you’ll be ready to get the proxy object and and call its method, or at least the ones you declared.</p>

<pre><code>    let notification_proxy = &lt;span class="kwrd"&gt;new&lt;/span&gt; NotificationProxy(DBus.session,
                                                    &lt;span class="str"&gt;'org.freedesktop.Notifications'&lt;/span&gt;,
                                                    &lt;span class="str"&gt;'/org/freedesktop/Notifications'&lt;/span&gt;);
    notification_proxy.NotifyRemote(&lt;span class="str"&gt;'my_app_sample'&lt;/span&gt;,    &lt;span class="rem"&gt;//these are the params of the method called&lt;/span&gt;
                                    0,
                                    &lt;span class="str"&gt;'dialog-info'&lt;/span&gt;,
                                    &lt;span class="str"&gt;'Summary of the notification'&lt;/span&gt;,
                                    &lt;span class="str"&gt;'Big Body of the sample Notification'&lt;/span&gt;,
                                    [],
                                    {},
                                    120,
                                    &lt;span class="kwrd"&gt;function&lt;/span&gt;(result, err){
                                        log(&lt;span class="str"&gt;'This is the result: '&lt;/span&gt; + result);
                                        log(&lt;span class="str"&gt;'This is the error: '&lt;/span&gt; + err);
    });
</code></pre>

<p>Well, and that’s it. After that you called the method and you have the callback set there, so you can what you want with the returned values.</p>

<h6>The conclusion</h6>

<p>I know there still a bunch of stuff you can make with DBus, but this is a start. There’re still watching for a bus name, and watching for signals and properties changes. It will come soon, I hope.</p>

<hr />

<p>[1] <a href="http://mail.gnome.org/archives/desktop-devel-list/2011-April/msg00147.html">Gjs vs Seed</a></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-05-28T21:52:58-04:00" pubdate data-updated="true">May 28<span>th</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/coding-samples/'>Coding Samples</a>


</div>
	
	<div class="comments"><a href="/blog/2011/05/28/dbus-in-gjs-and-gnome-shell/#disqus_thread">Comments</a></div>
	
</div>
</article>

<nav id="pagenavi">
    
        <a href="/blog/page/4/" class="prev">Prev</a>
    
    
        <a href="/blog/page/6/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2013

    Erick Pérez Castellanos

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'github-blog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//go.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





</body>
</html>